#!/bin/sh
#
# Test of RCDS/cvmfs tar files access from WFS jobs. You need to install
# the workflow and wfs-cvmfs-upload commands from the Workflow System GitHub:
# https://github.com/DUNE/dune-wfs/tree/main/commands
#
# 1) Create a tar file 
#    date > hello_world.txt
#    tar cvf hello_world.tar hello_world.txt
# 2) Upload to cvmfs
#    HELLO_WORLD_DIR=`wfs-cvmfs-upload hello_world.tar`
# 3) Wait until  ls $HELLO_WORLD_DIR  works (minutes?)
# 4) Create and run a request
#    workflow quick-request --monte-carlo 1 \
#    --env HELLO_WORLD_DIR="$HELLO_WORLD_DIR" \
#    --file cvmfs-hello-world.bootstrap
#
# Check the output through the dashboard:
# the date in hello_world.txt should beÂ printed.

# Get an unprocessed file from this stage and say we processed it
did_pfn_rse=`$WFS_PATH/wfs-get-file`
did=`echo $did_pfn_rse | cut -f1 -d' '`
echo "$did" > wfs-processed-dids.txt

# Look at the file in cvmfs
echo "Contents of $HELLO_WORLD_DIR/hello_world.txt"
cat $HELLO_WORLD_DIR/hello_world.txt
exit 0
